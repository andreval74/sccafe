<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SCCAFE - Compra de Tokens</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
  <link href="css/token.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
</head>
<body class="bg-dark text-white">

<!-- Cabeçalho -->
<header data-component="header"></header>

<!-- Loader (oculto por padrão) -->
<div id="loader" class="loader-container" style="display: none;">
  <div class="loader-spinner"></div>
  <p>Carregando...</p>
</div>

<main class="container-fluid py-5 min-vh-100">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-8">
        
        <h1 class="text-center mb-5">
          <i class="bi bi-currency-dollar me-2"></i>Compra de Tokens SCCAFE
        </h1>

        <!-- Mensagens do Sistema -->
        <div id="system-messages" class="mb-4"></div>
        
        <div id="main-content" class="opacity-0 transition-all">
          
          <!-- Seção 1: Conexão MetaMask - Design Limpo -->
          <div class="card bg-dark border-success shadow mb-4">
            <div class="card-header bg-success text-dark">
              <h5 class="card-title mb-0">
                <i class="bi bi-wallet2 me-2"></i>1. Conectar MetaMask
              </h5>
            </div>
            <div class="card-body">
              <div class="row align-items-center">
                <div class="col-md-8">
                  <h6 class="text-white mb-2">Status da Carteira</h6>
                  <p id="wallet-status" class="text-muted mb-0">Aguardando conexão...</p>
                  <p id="wallet-address" class="text-success font-monospace small mb-0" style="display: none;"></p>
                  <p id="wallet-network" class="text-info small mb-0" style="display: none;"></p>
                </div>
                <div class="col-md-4 text-end">
                  <button id="connect-metamask-btn" type="button" class="btn btn-success w-100 fw-bold">
                    <i class="bi bi-wallet2 me-2"></i>CONECTAR
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Seção 2: Detecção de Contrato -->
          <div class="card bg-dark border-info shadow mb-4" id="contract-detection-section" style="display: none;">
            <div class="card-header bg-info text-dark">
              <h5 class="card-title mb-0">
                <i class="bi bi-search me-2"></i>2. Detectar Contrato do Token
              </h5>
            </div>
            <div class="card-body">
              <div class="mb-3">
                <label for="contract-address" class="form-label">Endereço do Contrato</label>
                <div class="input-group">
                  <span class="input-group-text bg-secondary border-secondary text-white">
                    <i class="bi bi-code-square"></i>
                  </span>
                  <input type="text" class="form-control bg-dark border-secondary text-white" 
                         id="contract-address" 
                         placeholder="0x..." 
                         style="font-family: 'Courier New', monospace;">
                  <button id="detect-contract-btn" type="button" class="btn btn-info fw-bold">
                    <i class="bi bi-search me-2"></i>DETECTAR
                  </button>
                </div>
                <div class="form-text text-info">
                  Digite o endereço do contrato ERC-20 para verificar suas funcionalidades
                </div>
              </div>
              
              <!-- Área de Mensagens do Contrato -->
              <div id="contract-messages" class="mb-3"></div>
            </div>
          </div>

          <!-- Seção 3: Informações do Token -->
          <div class="card bg-dark border-success shadow mb-4" id="token-info-section" style="display: none;">
            <div class="card-header bg-success text-dark">
              <h5 class="card-title mb-0">
                <i class="bi bi-info-circle me-2"></i>3. Informações do Token
              </h5>
            </div>
            <div class="card-body">
              <div class="row g-3">
                <div class="col-md-6">
                  <small class="text-muted">Nome do Token</small>
                  <p id="token-name" class="fw-bold text-white">-</p>
                </div>
                <div class="col-md-6">
                  <small class="text-muted">Símbolo</small>
                  <p id="token-symbol" class="fw-bold text-success">-</p>
                </div>
                <div class="col-md-6">
                  <small class="text-muted">Decimais</small>
                  <p id="token-decimals" class="fw-bold text-white">-</p>
                </div>
                <div class="col-md-6">
                  <small class="text-muted">Preço por Token</small>
                  <p id="token-price-display" class="fw-bold text-success">-</p>
                </div>
              </div>
              
              <!-- Status das Funcionalidades -->
              <div class="mt-4">
                <h6 class="text-white mb-3">Status das Funcionalidades</h6>
                <div class="row g-3">
                  <div class="col-md-4 text-center">
                    <i class="bi bi-check-circle text-muted fs-2"></i>
                    <p id="erc20Status" class="fw-bold mb-1 text-muted">Verificando...</p>
                    <small class="text-muted">ERC-20</small>
                  </div>
                  <div class="col-md-4 text-center">
                    <i class="bi bi-arrow-up-right text-muted fs-2"></i>
                    <p id="transferStatus" class="fw-bold mb-1 text-muted">Verificando...</p>
                    <small class="text-muted">Transferência</small>
                  </div>
                  <div class="col-md-4 text-center">
                    <i class="bi bi-cart-plus text-muted fs-2"></i>
                    <p id="buyStatus" class="fw-bold mb-1 text-muted">Verificando...</p>
                    <small class="text-muted">Compra</small>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Seção 4: Compra de Tokens -->
          <div class="card bg-dark border-primary shadow mb-4" id="purchase-section" style="display: none;">
            <div class="card-header bg-primary text-white">
              <h5 class="card-title mb-0">
                <i class="bi bi-cart-plus me-2"></i>4. Comprar Tokens
              </h5>
            </div>
            <div class="card-body">
              <div class="row g-3">
                <div class="col-md-6">
                  <label for="token-price" class="form-label text-white">Preço por Token (BNB)</label>
                  <input type="number" class="form-control bg-secondary border-secondary text-white" 
                         id="token-price" readonly>
                  <div class="form-text text-muted">
                    Preço detectado automaticamente do contrato
                  </div>
                </div>
                <div class="col-md-6">
                  <label for="token-quantity" class="form-label text-white">Quantidade de Tokens</label>
                  <input type="number" class="form-control bg-dark border-secondary text-white" 
                         id="token-quantity" 
                         placeholder="Ex: 1000" 
                         min="1" 
                         step="1" 
                         disabled>
                </div>
              </div>

              <!-- Limites de Compra -->
              <div id="purchase-limits-info" class="alert alert-info bg-info text-dark mb-4" style="display: none;">
                <h6 class="mb-2"><i class="bi bi-info-circle me-2"></i>Limites de Compra</h6>
                <div class="row g-2">
                  <div class="col-md-6">
                    <strong>Compra Mínima:</strong> <span id="min-purchase">-</span>
                  </div>
                  <div class="col-md-6">
                    <strong>Compra Máxima:</strong> <span id="max-purchase">-</span>
                  </div>
                </div>
              </div>

              <div class="row g-3 align-items-end">
                <div class="col-md-6">
                  <label class="form-label text-white">Valor Total (BNB)</label>
                  <div class="input-group">
                    <span class="input-group-text bg-dark border-secondary text-white">
                      <i class="bi bi-currency-dollar"></i>
                    </span>
                    <input type="number" class="form-control bg-dark border-secondary text-white fw-bold" 
                           id="total-value" readonly>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="text-end">
                    <small class="text-muted d-block">Taxa de Rede Estimada</small>
                    <div class="d-flex align-items-center justify-content-end">
                      <i class="bi bi-lightning text-primary me-2"></i>
                      <p id="gasEstimate" class="fw-bold text-primary mb-0">~0.002 BNB</p>
                    </div>
                  </div>
                </div>
              </div>

              <div class="row mt-4">
                <div class="col-12">
                  <button id="execute-purchase-btn" type="button" class="btn btn-primary w-100 fw-bold" disabled>
                    <i class="bi bi-lightning me-2"></i>COMPRAR TOKENS
                  </button>
                </div>
              </div>
              
              <!-- Resultado da compra -->
              <div id="purchaseResult" class="mt-3" style="display: none;">
                <div class="alert alert-info mb-0">
                  <ul id="purchaseErrors" class="mb-0"></ul>
                </div>
              </div>
            </div>
          </div>

          <!-- Seção 5: Detalhes da Transação -->
          <div class="card bg-dark border-success shadow mb-4" id="transactionDetails" style="display: none;">
            <div class="card-header bg-success text-dark">
              <h5 class="card-title mb-0">
                <i class="bi bi-receipt me-2"></i>5. Detalhes da Transação
              </h5>
            </div>
            <div class="card-body">
              <div class="row g-3">
                <div class="col-md-6">
                  <small class="text-muted">ID da Transação</small>
                  <p id="txHash" class="fw-bold font-monospace small text-break text-primary">-</p>
                </div>
                <div class="col-md-6">
                  <small class="text-muted">Tokens Recebidos</small>
                  <p id="txTokensReceived" class="fw-bold text-success">-</p>
                </div>
                <div class="col-md-4">
                  <small class="text-muted">Valor Enviado</small>
                  <p id="txValue" class="fw-bold text-white">- BNB</p>
                </div>
                <div class="col-md-4">
                  <small class="text-muted">Taxa da Rede</small>
                  <p id="txGasPrice" class="fw-bold text-white">- BNB</p>
                </div>
                <div class="col-md-4">
                  <small class="text-muted">Total Pago</small>
                  <p id="txTotalCost" class="fw-bold text-primary">- BNB</p>
                </div>
              </div>
              
              <!-- Botão Nova Compra -->
              <div class="row mt-4">
                <div class="col-12 text-center">
                  <button id="new-purchase-btn" type="button" class="btn btn-success btn-lg px-5">
                    <i class="bi bi-arrow-clockwise me-2"></i>NOVA COMPRA
                  </button>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
</main>

<!-- Footer -->
<footer data-component="footer"></footer>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- SCCAFE Shared Modules (carregados antes do módulo específico) -->
<script src="js/shared/metamask-connector.js"></script>
<script src="js/shared/common-utils.js"></script>
<script src="js/shared/token-global.js"></script>

<!-- Template Loader -->
<script src="js/template-loader.js"></script>

<!-- Módulo de Compra de Tokens -->
<script src="js/compra-token.js"></script>

</body>
</html>
